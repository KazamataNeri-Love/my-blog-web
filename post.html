<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>阅读文章</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* 保持你原本的 CSS */
        body { max-width: 800px; margin: 20px auto; padding: 20px; font-family: "Segoe UI", sans-serif; line-height: 1.8; color: #24292f; }
        .nav { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .back-link { text-decoration: none; color: #0969da; font-weight: bold; }
        /* ... 省略重复 CSS ... */
    </style>
</head>
<body>
    <div class="nav">
        <a href="index.html" class="back-link">← 返回文章列表</a>
    </div>

    <div id="content">正在加载文章...</div>

    <script type="module">
        import { getPost, downloadFile } from "./js/api.js";
        
        const params = new URLSearchParams(location.search);
        const path = params.get("f") ? decodeURIComponent(params.get("f")) : null;

        if(path) {
            loadPost();
        } else {
            document.getElementById("content").innerText = "未指定文章";
        }

        async function loadPost() {
            try {
                // 使用 api.js 的 getPost，它现在支持完整路径
                const text = await getPost(path);
                const div = document.getElementById("content");
                div.innerHTML = marked.parse(text);
                
                // 绑定下载
                div.querySelectorAll('.file-download').forEach(btn => {
                    btn.onclick = () => downloadFile(btn.getAttribute('data-path'));
                });

                document.title = path.split('/').pop().replace('.md','') || "阅读文章";

            } catch (e) {
                document.getElementById("content").innerText = "文章加载失败: " + e.message;
            }
        }
    </script>
</body>
</html>
