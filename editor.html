<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç¼–è¾‘å™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- åŸºç¡€è®¾ç½® (ç­‰å®½å­—ä½“) --- */
        body { 
            margin: 0; padding: 0; height: 100vh;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            background: #fff; color: #333;
            display: flex; flex-direction: column;
        }
        
        * { box-sizing: border-box; }
        a { text-decoration: none; }

        /* --- é¡¶éƒ¨å¯¼èˆªæ  --- */
        .top-bar {
            padding: 10px 20px;
            border-bottom: 1px solid #d0d7de;
            background: #f6f8fa;
            display: flex; justify-content: space-between; align-items: center;
            flex-shrink: 0;
        }

        .back-link { color: #0969da; font-size: 14px; display: inline-flex; align-items: center; gap: 5px;}
        
        .header-inputs { flex: 1; margin: 0 20px; display: flex; gap: 10px; align-items: center; }
        .header-inputs label { font-weight: bold; font-size: 14px; white-space: nowrap; }
        .header-inputs input {
            flex: 1; padding: 8px 12px; font-size: 14px;
            border: 1px solid #d0d7de; border-radius: 6px; font-family: inherit;
        }
        .header-inputs input:focus { outline: 2px solid #0969da; border-color: transparent; }

        .header-actions { display: flex; gap: 10px; }

        /* --- ä¸»ä½“åŒºåŸŸ (Flex å¸ƒå±€) --- */
        .main-container {
            flex: 1; display: flex; overflow: hidden; position: relative;
        }

        /* å·¦ä¾§ï¼šç¼–è¾‘å™¨ */
        .editor-pane {
            flex: 1; display: flex; flex-direction: column;
            border-right: 1px solid #d0d7de;
            transition: width 0.3s;
            min-width: 0; /* é˜²æ­¢ flex å­å…ƒç´ æº¢å‡º */
        }

        /* å·¥å…·æ  */
        .toolbar {
            padding: 8px 15px; border-bottom: 1px solid #d0d7de;
            background: #fff; display: flex; gap: 6px; flex-wrap: wrap; align-items: center;
        }
        .tool-btn {
            background: white; border: 1px solid #d0d7de; padding: 4px 10px;
            border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 600;
            color: #24292f; font-family: inherit; display: flex; align-items: center; gap: 5px;
        }
        .tool-btn:hover { background: #f3f4f6; border-color: #8b949e; }
        .tool-btn.active { background: #eef3f8; color: #0969da; border-color: #0969da; }
        .tool-sep { width: 1px; height: 20px; background: #d0d7de; margin: 0 5px; }

        textarea {
            flex: 1; width: 100%; resize: none; border: none; padding: 20px;
            font-family: inherit; font-size: 14px; line-height: 1.6; outline: none;
            overflow-y: auto; background: #fff;
        }

        /* å³ä¾§ï¼šé¢„è§ˆåŒº */
        .preview-pane {
            flex: 1; overflow-y: auto; padding: 40px;
            background: #191919; /* æ·±è‰²èƒŒæ™¯ */
            display: none; /* é»˜è®¤éšè—ï¼Œå•æ æ¨¡å¼ä¸‹é€šè¿‡ toggler æ§åˆ¶ */
            border-left: 1px solid #333;
        }

        /* é¢„è§ˆå†…å®¹æ ·å¼ (æ·±è‰²æ¨¡å¼) */
        .markdown-body { line-height: 1.8; color: #d4d4d4; font-size: 14px; max-width: 100%; }
        .markdown-body h1, .markdown-body h2 { color: #fff; border-bottom: 1px solid #333; margin-top: 20px; }
        .markdown-body a { color: #3794ff; text-decoration: none; }
        .markdown-body blockquote { border-left: 0.25em solid #3794ff; background: #222; color: #999; padding: 10px; }
        .markdown-body code { background-color: rgba(110,118,129,0.4); font-family: inherit; padding: 2px 5px; border-radius: 4px; }
        .markdown-body pre { background-color: #161b22; border: 1px solid #30363d; padding: 16px; overflow: auto; border-radius: 6px; }
        .markdown-body table { border-collapse: collapse; width: 100%; margin: 15px 0; }
        .markdown-body th, .markdown-body td { border: 1px solid #30363d; padding: 6px 13px; }
        .markdown-body img { max-width: 100%; border-radius: 4px; background: #fff; display: block; margin: 10px 0; }

        /* --- æ–‡ä»¶å¡ç‰‡æ ·å¼ --- */
        .file-card {
            background: #21262d; 
            border: 1px solid #30363d; 
            border-radius: 6px;
            padding: 12px 16px; 
            margin: 15px 0; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }
        .file-name { 
            font-weight: 600; 
            color: #3794ff; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        .file-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .file-note {
            font-size: 12px;
            color: #8b949e;
            background: #30363d;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .file-download {
            color: #e0e0e0; 
            font-size: 13px; 
            padding: 4px 10px;
            background: #30363d; 
            border-radius: 4px; 
            cursor: pointer; 
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: 0.2s;
        }
        .file-download:hover { 
            background: #3794ff; 
            color: white; 
        }

        /* --- åº•éƒ¨çŠ¶æ€æ  --- */
        .status-bar {
            padding: 5px 20px; background: #f6f8fa; border-top: 1px solid #d0d7de;
            font-size: 12px; color: #57606a; display: flex; justify-content: space-between;
        }

        /* --- æŒ‰é’®æ ·å¼ --- */
        .btn-primary { 
            background: #2da44e; color: white; border: none; padding: 6px 16px; 
            border-radius: 6px; font-size: 14px; font-weight: bold; cursor: pointer; font-family: inherit;
        }
        .btn-primary:hover { background: #2c974b; }
        .btn-primary:disabled { background: #94d3a2; cursor: wait; }

        /* --- æ¨¡æ€æ¡† --- */
        .modal-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index: 999; justify-content: center; align-items: center; }
        .modal { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); width: 400px; max-width: 90%; }
        .modal h3 { margin-top: 0; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        
        #img-preview-box { 
            width: 100%; height: 200px; background: #f6f8fa; 
            display: flex; align-items: center; justify-content: center; 
            border: 1px dashed #d0d7de; border-radius: 6px; margin-bottom: 15px; 
        }
        #img-preview-box img { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        .modal-input { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #d0d7de; border-radius: 4px; box-sizing: border-box; }
        .modal-label { display:block; font-size:12px; font-weight:bold; margin-bottom:5px; color:#555; }
        .modal-footer { text-align: right; margin-top: 15px; display: flex; justify-content: flex-end; gap: 10px; }
        
        /* åˆ—è¡¨å¼¹çª— */
        #file-list { list-style: none; padding: 0; max-height: 300px; overflow-y: auto; border: 1px solid #eee; }
        #file-list li { padding: 8px; border-bottom: 1px solid #f0f0f0; cursor: pointer; display: flex; align-items: center; font-size: 13px; }
        #file-list li:hover { background: #f6f8fa; }
    </style>
</head>
<body>

    <!-- é¡¶éƒ¨æ  -->
    <div class="top-bar">
        <a href="index.html" class="back-link"><i class="fa-solid fa-arrow-left"></i> è¿”å›åˆ—è¡¨</a>
        
        <div class="header-inputs">
            <label>æ ‡é¢˜:</label>
            <input type="text" id="post-title" placeholder="è¾“å…¥è´´æ–‡æ ‡é¢˜...">
        </div>

        <div class="header-actions">
            <button id="saveBtn" class="btn-primary"><i class="fa-solid fa-floppy-disk"></i> ä¿å­˜</button>
        </div>
    </div>

    <!-- ä¸»ä½“ï¼šç¼–è¾‘å™¨ + é¢„è§ˆ -->
    <div class="main-container" id="main-container">
        
        <!-- å·¦ä¾§ç¼–è¾‘åŒº -->
        <div class="editor-pane" id="editor-pane">
            <div class="toolbar">
                <button class="tool-btn" onclick="insertMD('**', '**')"><b>B</b></button>
                <button class="tool-btn" onclick="insertMD('*', '*')"><i>I</i></button>
                <button class="tool-btn" onclick="insertMD('# ', '')">H1</button>
                <button class="tool-btn" onclick="insertMD('## ', '')">H2</button>
                <div class="tool-sep"></div>
                <button class="tool-btn" onclick="insertTable()"><i class="fa-solid fa-table"></i></button>
                <button class="tool-btn" onclick="insertMD('> ', '')"><i class="fa-solid fa-quote-right"></i></button>
                <button class="tool-btn" onclick="insertMD('\n---\n', '')"><i class="fa-solid fa-ruler-horizontal"></i></button>
                <div class="tool-sep"></div>
                <button class="tool-btn" onclick="triggerFileSelect()" title="ä¸Šä¼ å›¾ç‰‡"><i class="fa-regular fa-image"></i> å›¾ç‰‡</button>
                <button class="tool-btn" id="openFileBtn" title="æ’å…¥ä»“åº“å†…æ–‡ä»¶"><i class="fa-solid fa-paperclip"></i> æ–‡ä»¶</button>
                <button class="tool-btn" id="openExtLinkBtn" title="æ’å…¥GitHub Releaseæˆ–ç½‘ç›˜é“¾æ¥"><i class="fa-solid fa-link"></i> å¤–éƒ¨/ç½‘ç›˜</button>
                
                <!-- éšè—çš„ input -->
                <input type="file" id="img-upload-input" accept="image/*" style="display:none">

                <!-- åˆ†æ åˆ‡æ¢æŒ‰é’® (å³å¯¹é½) -->
                <button class="tool-btn" id="btn-toggle-split" style="margin-left: auto;" onclick="toggleSplitMode()">
                    <i class="fa-solid fa-columns"></i> åˆ†æ é¢„è§ˆ
                </button>
            </div>
            
            <textarea id="content" placeholder="åœ¨æ­¤æ’°å†™ Markdown... (Ctrl+S ä¿å­˜)"></textarea>
        </div>

        <!-- å³ä¾§é¢„è§ˆåŒº -->
        <div class="preview-pane" id="preview-pane">
            <div id="preview-content" class="markdown-body"></div>
        </div>

    </div>

    <!-- åº•éƒ¨çŠ¶æ€ -->
    <div class="status-bar">
        <span id="status-text">å‡†å¤‡å°±ç»ª</span>
        <span id="word-count">0 å­—</span>
    </div>

    <!-- å›¾ç‰‡ä¸Šä¼ æ¨¡æ€æ¡† -->
    <div id="img-modal-overlay" class="modal-overlay">
        <div class="modal">
            <h3>æ’å…¥å›¾ç‰‡</h3>
            <div id="img-preview-box"><span style="color:#999">é¢„è§ˆåŒº</span></div>
            <label class="modal-label">Github Token:</label>
            <input type="password" id="upload-token" class="modal-input" placeholder="è¾“å…¥ Token">
            <div class="modal-footer">
                <button class="tool-btn" onclick="closeImgModal()">å–æ¶ˆ</button>
                <button class="btn-primary" id="btn-confirm-upload">ä¸Šä¼ å¹¶æ’å…¥</button>
            </div>
        </div>
    </div>

    <!-- æ–‡ä»¶é€‰æ‹©æ¨¡æ€æ¡† -->
    <div id="file-modal-overlay" class="modal-overlay">
        <div class="modal">
            <h3>é€‰æ‹©ä»“åº“æ–‡ä»¶</h3>
            <div id="current-path" style="font-size:12px;color:#666;margin-bottom:5px">/</div>
            <ul id="file-list">åŠ è½½ä¸­...</ul>
            <div class="modal-footer">
                <button class="tool-btn" onclick="document.getElementById('file-modal-overlay').style.display='none'">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- å¤–éƒ¨é“¾æ¥æ¨¡æ€æ¡† (æ–°å¢) -->
    <div id="ext-link-overlay" class="modal-overlay">
        <div class="modal">
            <h3>æ’å…¥å¤–éƒ¨/Release èµ„æº</h3>
            
            <label class="modal-label">èµ„æºæ˜¾ç¤ºåç§°:</label>
            <input type="text" id="ext-name" class="modal-input" placeholder="ä¾‹å¦‚: æ¸¸æˆå®Œæ•´ç‰ˆ v1.0.zip">
            
            <label class="modal-label">ä¸‹è½½é“¾æ¥ (URL):</label>
            <input type="text" id="ext-url" class="modal-input" placeholder="https://github.com/.../releases/.../file.zip">
            
            <label class="modal-label">æå–ç /å¤‡æ³¨ (å¯é€‰):</label>
            <input type="text" id="ext-note" class="modal-input" placeholder="ä¾‹å¦‚: æå–ç  1234 æˆ– è§£å‹å¯†ç : none">

            <div class="modal-footer">
                <button class="tool-btn" onclick="document.getElementById('ext-link-overlay').style.display='none'">å–æ¶ˆ</button>
                <button class="btn-primary" onclick="insertExtLink()">ç¡®è®¤æ’å…¥</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { savePost, getPost, listDir, uploadImage, downloadFile } from "./js/api.js";

        // DOM å…ƒç´ 
        const titleInput = document.getElementById("post-title");
        const contentArea = document.getElementById("content");
        const previewPane = document.getElementById("preview-pane");
        const previewContent = document.getElementById("preview-content");
        const btnSplit = document.getElementById("btn-toggle-split");
        const statusText = document.getElementById("status-text");
        const wordCount = document.getElementById("word-count");
        
        // çŠ¶æ€å˜é‡
        let isSplitMode = false;
        const params = new URLSearchParams(location.search);
        const editFilename = params.get("edit") ? decodeURIComponent(params.get("edit")) : null;

        // --- åˆå§‹åŒ– ---
        async function init() {
            if (editFilename) {
                statusText.innerText = `æ­£åœ¨ç¼–è¾‘: ${editFilename}`;
                try {
                    const fullText = await getPost(editFilename);
                    const lines = fullText.split('\n');
                    if (lines[0].startsWith('# ')) {
                        titleInput.value = lines[0].replace('# ', '').trim();
                        contentArea.value = lines.slice(1).join('\n').trim();
                    } else {
                        titleInput.value = editFilename.replace(".md", "").replace(/^\d{4}-\d{2}-\d{2}-/, "");
                        contentArea.value = fullText;
                    }
                    updatePreview(); // åŠ è½½å®Œç«‹å³æ¸²æŸ“ä¸€æ¬¡é¢„è§ˆ
                } catch(e) { alert("è¯»å–å¤±è´¥: " + e.message); }
            } else {
                statusText.innerText = "æ–°å»ºæ¨¡å¼";
            }
            toggleSplitMode(); // é»˜è®¤å¼€å¯
        }
        init();

        // --- æ ¸å¿ƒï¼šåˆ†æ ä¸å®æ—¶æ¸²æŸ“ ---
        
        window.toggleSplitMode = () => {
            isSplitMode = !isSplitMode;
            if (isSplitMode) {
                previewPane.style.display = "block";
                btnSplit.classList.add("active");
                btnSplit.innerHTML = `<i class="fa-solid fa-table-columns"></i> å…³é—­åˆ†æ `;
                updatePreview();
            } else {
                previewPane.style.display = "none";
                btnSplit.classList.remove("active");
                btnSplit.innerHTML = `<i class="fa-solid fa-columns"></i> åˆ†æ é¢„è§ˆ`;
            }
        };

        contentArea.addEventListener('input', () => {
            wordCount.innerText = `${contentArea.value.length} å­—`;
            if (isSplitMode) updatePreview();
        });

        function updatePreview() {
            const rawMarkdown = contentArea.value;
            const title = titleInput.value.trim();
            const previewMd = `# ${title || 'æ— æ ‡é¢˜'}\n\n${rawMarkdown}`;
            previewContent.innerHTML = marked.parse(previewMd);
            
            previewContent.querySelectorAll('img').forEach(img => {
                img.onerror = () => { img.style.border = "1px solid red"; img.alt += " (å¤±è´¥)"; };
            });

            // ç»‘å®šé¢„è§ˆåŒºä¸‹è½½ç‚¹å‡»äº‹ä»¶
            previewContent.querySelectorAll('.file-download').forEach(btn => {
                btn.onclick = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    downloadFile(btn.getAttribute('data-path'));
                };
            });
        }

        // æ»šåŠ¨åŒæ­¥
        contentArea.addEventListener('scroll', () => {
            if (!isSplitMode) return;
            const percentage = contentArea.scrollTop / (contentArea.scrollHeight - contentArea.offsetHeight);
            previewPane.scrollTop = percentage * (previewPane.scrollHeight - previewPane.offsetHeight);
        });

        // --- åŠŸèƒ½1ï¼šå›¾ç‰‡ä¸Šä¼  ---
        const imgInput = document.getElementById("img-upload-input");
        const imgModal = document.getElementById("img-modal-overlay");
        const imgPreviewBox = document.getElementById("img-preview-box");
        let selectedImgFile = null;

        window.triggerFileSelect = () => {
            if(!titleInput.value.trim() && !editFilename) return alert("è¯·å…ˆè¾“å…¥æ ‡é¢˜ï¼Œç”¨äºç”Ÿæˆå›¾ç‰‡æ–‡ä»¶å¤¹");
            imgInput.click();
        };

        imgInput.addEventListener("change", () => {
            if (!imgInput.files[0]) return;
            selectedImgFile = imgInput.files[0];
            const reader = new FileReader();
            reader.onload = (e) => imgPreviewBox.innerHTML = `<img src="${e.target.result}" style="max-height:100%">`;
            reader.readAsDataURL(selectedImgFile);
            imgModal.style.display = "flex";
            const savedToken = localStorage.getItem("github_token");
            if(savedToken) document.getElementById("upload-token").value = savedToken;
        });

        window.closeImgModal = () => {
            imgModal.style.display = "none";
            imgInput.value = "";
            selectedImgFile = null;
        };

        document.getElementById("btn-confirm-upload").onclick = async function() {
            const token = document.getElementById("upload-token").value.trim();
            if(!token) return alert("è¯·è¾“å…¥Token");
            localStorage.setItem("github_token", token);
            
            this.innerText = "ä¸Šä¼ ä¸­...";
            this.disabled = true;

            try {
                let folderName = "";
                if (editFilename) {
                    folderName = editFilename.replace(".md", "");
                } else {
                    const now = new Date();
                    folderName = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}-${titleInput.value.trim()}`;
                }
                const url = await uploadImage(selectedImgFile, folderName, token);
                window.insertMD(`\n![${selectedImgFile.name}](${url})\n`, "");
                if(isSplitMode) updatePreview();
                closeImgModal();
                statusText.innerText = "âœ… å›¾ç‰‡ä¸Šä¼ æˆåŠŸ";
            } catch(e) {
                alert("ä¸Šä¼ å¤±è´¥: " + e.message);
            } finally {
                this.innerText = "ä¸Šä¼ å¹¶æ’å…¥";
                this.disabled = false;
            }
        };

        // --- åŠŸèƒ½2ï¼šæ’å…¥å¤–éƒ¨/Release é“¾æ¥ (å…³é”®ä¿®å¤ï¼šç§»é™¤æ‰€æœ‰ç¼©è¿›) ---
        const extModal = document.getElementById("ext-link-overlay");
        document.getElementById("openExtLinkBtn").onclick = () => {
            document.getElementById("ext-name").value = "";
            document.getElementById("ext-url").value = "";
            document.getElementById("ext-note").value = "";
            extModal.style.display = "flex";
        };

        window.insertExtLink = () => {
            const name = document.getElementById("ext-name").value.trim();
            const url = document.getElementById("ext-url").value.trim();
            const note = document.getElementById("ext-note").value.trim();

            if (!name || !url) return alert("åç§°å’Œé“¾æ¥ä¸èƒ½ä¸ºç©º");

            let noteHtml = note ? `<span class="file-note">${note}</span>` : "";
            
            // ğŸ”´ å…³é”®ä¿®å¤ï¼šè¿™é‡Œçš„ HTML å­—ç¬¦ä¸²å¿…é¡»ç´§è´´å·¦è¾¹ï¼Œä¸èƒ½æœ‰ä»»ä½•ç¼©è¿›ï¼
const fileCardHtml = `<div class="file-card">
<span class="file-name"><i class="fa-solid fa-globe"></i> ${name}</span>
<div class="file-info">
${noteHtml}
<a class="file-download" href="javascript:void(0)" data-path="${url}" onclick="event.stopPropagation()">
<i class="fa-solid fa-cloud-arrow-down"></i> ä¸‹è½½
</a>
</div>
</div>`;

            window.insertMD(`\n${fileCardHtml}\n`, "");
            extModal.style.display = "none";
        };

        // --- åŠŸèƒ½3ï¼šæ’å…¥ä»“åº“æ–‡ä»¶ (å…³é”®ä¿®å¤ï¼šç§»é™¤æ‰€æœ‰ç¼©è¿›) ---
        let currentPath = "";
        document.getElementById("openFileBtn").onclick = () => {
            document.getElementById("file-modal-overlay").style.display = "flex";
            loadFiles("");
        };
        
        async function loadFiles(path) {
            currentPath = path;
            document.getElementById("current-path").innerText = path || "/";
            const listEl = document.getElementById("file-list");
            listEl.innerHTML = "<li>åŠ è½½ä¸­...</li>";
            const items = await listDir(path);
            listEl.innerHTML = "";
            if(path) {
                const li = document.createElement("li");
                li.innerHTML = "ğŸ”™ è¿”å›ä¸Šçº§";
                li.onclick = () => {
                    const parts = currentPath.split('/');
                    parts.pop();
                    loadFiles(parts.join('/'));
                };
                listEl.appendChild(li);
            }
            items.forEach(item => {
                const li = document.createElement("li");
                li.innerHTML = item.type === 'dir' ? `ğŸ“‚ ${item.name}` : `ğŸ“„ ${item.name}`;
                li.onclick = () => {
                    if(item.type === 'dir') loadFiles(item.path);
                    else {
                        // ğŸ”´ å…³é”®ä¿®å¤ï¼šç§»é™¤ç¼©è¿›
const fileCardHtml = `<div class="file-card">
<span class="file-name"><i class="fa-solid fa-file-lines"></i> ${item.name}</span>
<div class="file-info">
<a class="file-download" href="javascript:void(0)" data-path="${item.path}" onclick="event.stopPropagation()">
<i class="fa-solid fa-arrow-down"></i> ä¸‹è½½
</a>
</div>
</div>`;
                        window.insertMD(`\n${fileCardHtml}\n`, "");
                        document.getElementById("file-modal-overlay").style.display = 'none';
                    }
                };
                listEl.appendChild(li);
            });
        }

        // --- ä¿å­˜ä¸å·¥å…· ---
        document.getElementById("saveBtn").onclick = async function() {
            const title = titleInput.value.trim();
            const body = contentArea.value;
            if(!title) return alert("è¯·è¾“å…¥æ ‡é¢˜");

            let token = localStorage.getItem("github_token");
            if (!token) token = prompt("è¯·è¾“å…¥ Token:");
            if (!token) return;
            localStorage.setItem("github_token", token);

            this.disabled = true;
            this.innerHTML = "ä¿å­˜ä¸­...";
            
            try {
                let filename = editFilename;
                if (!filename) {
                    const now = new Date();
                    filename = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}-${title}.md`;
                }
                const content = `# ${title}\n\n${body}`;
                await savePost(filename, content, token);
                alert("ä¿å­˜æˆåŠŸ!");
                window.location.href = "index.html";
            } catch(e) {
                alert("ä¿å­˜å¤±è´¥: " + e.message);
                this.disabled = false;
                this.innerHTML = `<i class="fa-solid fa-floppy-disk"></i> ä¿å­˜`;
            }
        };

        window.insertMD = (prefix, suffix) => {
            const start = contentArea.selectionStart;
            const end = contentArea.selectionEnd;
            const text = contentArea.value;
            contentArea.value = text.substring(0, start) + prefix + text.substring(start, end) + suffix + text.substring(end);
            contentArea.focus();
            contentArea.selectionStart = start + prefix.length;
            contentArea.selectionEnd = end + prefix.length;
            if(isSplitMode) updatePreview();
        };
        window.insertTable = () => window.insertMD('\n| è¡¨å¤´1 | è¡¨å¤´2 |\n| --- | --- |\n| å†…å®¹1 | å†…å®¹2 |\n', '');
        
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                document.getElementById("saveBtn").click();
            }
        });
    </script>
</body>
</html>
