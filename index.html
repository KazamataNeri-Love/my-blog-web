<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„åšå®¢</title>
    <style>
        body { font-family: "Segoe UI", sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; color: #333; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 20px; }
        h1 { margin: 0; font-size: 24px; }
        
        .btn { text-decoration: none; padding: 8px 16px; border-radius: 6px; font-size: 14px; font-weight: bold; transition: 0.2s; }
        .btn-primary { background: #2da44e; color: white; }
        .btn-primary:hover { background: #2c974b; }
        
        ul { list-style: none; padding: 0; }
        li { padding: 15px 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: flex-start; }
        
        .post-info { flex: 1; }
        .post-title { font-size: 18px; text-decoration: none; color: #0969da; font-weight: 600; display: block; margin-bottom: 4px; }
        .post-title:hover { text-decoration: underline; }
        .post-meta { font-size: 12px; color: #666; font-family: monospace; }
        
        .action-btn { font-size: 12px; color: #57606a; text-decoration: none; padding: 4px 10px; border: 1px solid #d0d7de; border-radius: 6px; margin-left: 10px; white-space: nowrap; background: #f6f8fa;}
        .action-btn:hover { background: #f3f4f6; color: #0969da; border-color: #0969da; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“‘ æˆ‘çš„åšå®¢</h1>
        <a href="editor.html" class="btn btn-primary">â• æ–°å»ºè´´æ–‡</a>
    </div>
    <ul id="list">
        <li style="color:#666">â³ æ­£åœ¨åŠ è½½æ–‡ç« åˆ—è¡¨...</li>
    </ul>

    <script type="module">
        import { listPosts, getPost } from "./js/api.js";
        
        const list = document.getElementById("list");
        
        async function init() {
            const posts = await listPosts();
            
            // è¿‡æ»¤émdæ–‡ä»¶
            const mdFiles = posts.filter(p => p.name.endsWith(".md"));

            if (mdFiles.length === 0) {
                list.innerHTML = "<li style='text-align:center'>è¿˜æ²¡æœ‰æ–‡ç« ï¼Œå¿«å»å†™ä¸€ç¯‡å§ï¼</li>";
                return;
            }

            // æŒ‰æ–‡ä»¶åå€’åºï¼ˆå› ä¸ºæ–‡ä»¶ååŒ…å«æ—¥æœŸï¼Œå€’åºå°±æ˜¯æœ€æ–°çš„åœ¨å‰ï¼‰
            mdFiles.sort((a, b) => b.name.localeCompare(a.name));
            
            list.innerHTML = "";

            // éå†æ¯ä¸ªæ–‡ä»¶
            for (const file of mdFiles) {
                const li = document.createElement("li");
                
                // é»˜è®¤å…ˆæ˜¾ç¤ºæ–‡ä»¶åï¼Œç¨åå¼‚æ­¥åŠ è½½æ ‡é¢˜
                li.innerHTML = `
                    <div class="post-info">
                        <a href="post.html?f=${file.name}" class="post-title" id="title-${file.sha}">ğŸ“„ åŠ è½½æ ‡é¢˜ä¸­...</a>
                        <span class="post-meta">${file.name}</span>
                    </div>
                    <a href="editor.html?edit=${file.name}" class="action-btn">âœï¸ ç¼–è¾‘</a>
                `;
                list.appendChild(li);

                // å¼‚æ­¥è·å–å†…å®¹æå–æ ‡é¢˜ (ä¸é˜»å¡é¡µé¢æ˜¾ç¤º)
                getPost(file.name).then(text => {
                    const firstLine = text.split('\n')[0];
                    // å»æ‰ # å·
                    const title = firstLine.replace(/^#+\s*/, '').trim() || "æ— æ ‡é¢˜";
                    document.getElementById(`title-${file.sha}`).innerText = title;
                });
            }
        }
        init();
    </script>
</body>
</html>
