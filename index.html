<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„åšå®¢</title>
    <style>
        body { font-family: "Segoe UI", sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; color: #333; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 20px; }
        h1 { margin: 0; font-size: 24px; }
        
        .btn { text-decoration: none; padding: 8px 16px; border-radius: 6px; font-size: 14px; font-weight: bold; transition: 0.2s; }
        .btn-primary { background: #2da44e; color: white; }
        .btn-primary:hover { background: #2c974b; }
        
        ul { list-style: none; padding: 0; }
        li { padding: 15px 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: flex-start; }
        
        .post-info { flex: 1; }
        .post-title { font-size: 18px; text-decoration: none; color: #0969da; font-weight: 600; display: block; margin-bottom: 4px; }
        .post-title:hover { text-decoration: underline; }
        .post-meta { font-size: 12px; color: #666; font-family: monospace; }
        
        .action-btn { font-size: 12px; color: #57606a; text-decoration: none; padding: 4px 10px; border: 1px solid #d0d7de; border-radius: 6px; margin-left: 10px; white-space: nowrap; background: #f6f8fa;}
        .action-btn:hover { background: #f3f4f6; color: #0969da; border-color: #0969da; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“‘ æˆ‘çš„åšå®¢</h1>
        <a href="editor.html" class="btn btn-primary">â• æ–°å»ºè´´æ–‡</a>
    </div>
    <ul id="list">
        <li style="color:#666">â³ æ­£åœ¨åŠ è½½æ–‡ç« åˆ—è¡¨...</li>
    </ul>

    <script type="module">
        import { listPosts } from "./js/api.js";
        
        const list = document.getElementById("list");
        
        async function init() {
            try {
                const posts = await listPosts();
                // è¿‡æ»¤ md æ–‡ä»¶
                const mdFiles = posts.filter(p => p.name.endsWith(".md"));

                if (mdFiles.length === 0) {
                    list.innerHTML = "<li style='text-align:center'>è¿˜æ²¡æœ‰æ–‡ç« ï¼Œå¿«å»å†™ä¸€ç¯‡å§ï¼</li>";
                    return;
                }

                // æŒ‰æ–‡ä»¶åå€’åº (å› ä¸ºæ ¼å¼æ˜¯ YYYY-MM-DDï¼Œå€’åºå°±æ˜¯æœ€æ–°çš„åœ¨å‰)
                mdFiles.sort((a, b) => b.name.localeCompare(a.name));
                
                list.innerHTML = "";

                for (const file of mdFiles) {
                    const li = document.createElement("li");
                    
                    // 1. è§£ç ä¸­æ–‡æ–‡ä»¶å
                    let rawName = decodeURIComponent(file.name);
                    // 2. å»æ‰ .md
                    let displayName = rawName.replace(".md", "");
                    // 3. å°è¯•å»æ‰æ—¥æœŸå‰ç¼€ (ä¾‹å¦‚ 2026-01-14-)
                    // æ­£åˆ™ï¼šåŒ¹é…å¼€å¤´çš„ 4ä½æ•°å­—-2ä½æ•°å­—-2ä½æ•°å­—-
                    const cleanTitle = displayName.replace(/^\d{4}-\d{1,2}-\d{1,2}-/, "");

                    li.innerHTML = `
                        <div class="post-info">
                            <!-- é“¾æ¥å‚æ•°ä¿æŒåŸå§‹æ–‡ä»¶å -->
                            <a href="post.html?f=${file.name}" class="post-title">ğŸ“„ ${cleanTitle}</a>
                            <span class="post-meta">${file.name}</span>
                        </div>
                        <a href="editor.html?edit=${file.name}" class="action-btn">âœï¸ ç¼–è¾‘</a>
                    `;
                    list.appendChild(li);
                }
            } catch (e) {
                console.error(e);
                list.innerHTML = `<li style="color:red">âš ï¸ åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚</li>`;
            }
        }
        init();
    </script>
</body>
</html>
