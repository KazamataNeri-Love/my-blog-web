<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„çŸ¥è¯†åº“</title>
    <!-- å¼•å…¥å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-sidebar: #1e1e1e;       /* ä¾§è¾¹æ èƒŒæ™¯ */
            --bg-main: #191919;          /* ä¸»å†…å®¹èƒŒæ™¯ */
            --text-main: #e0e0e0;        /* ä¸»è¦æ–‡å­— */
            --text-sub: #858585;         /* æ¬¡è¦æ–‡å­— */
            --accent-color: #3794ff;     /* è“è‰²é«˜äº® */
            --hover-bg: #2d2d2d;         /* æ‚¬åœèƒŒæ™¯ */
            --border-color: #333333;     /* è¾¹æ¡†é¢œè‰² */
            --tag-bg: #2d2d2d;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden; /* é˜²æ­¢æ•´ä¸ªé¡µé¢æ»šåŠ¨ */
        }

        /* --- å·¦ä¾§ä¾§è¾¹æ  --- */
        .sidebar {
            width: 300px;
            background-color: var(--bg-sidebar);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        /* æœç´¢æ¡†åŒºåŸŸ */
        .search-container {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .search-box {
            background: #2d2d2d;
            border: 1px solid #3e3e3e;
            border-radius: 4px;
            display: flex;
            align-items: center;
            padding: 6px 10px;
        }

        .search-box i { color: var(--text-sub); font-size: 14px; }
        .search-box input {
            background: transparent;
            border: none;
            color: var(--text-main);
            margin-left: 8px;
            width: 100%;
            outline: none;
        }

        /* å¯¼èˆªåˆ—è¡¨ */
        .nav-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
            list-style: none;
        }

        .nav-group-title {
            padding: 10px 20px;
            font-size: 12px;
            color: var(--text-sub);
            font-weight: bold;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .nav-group-title i { margin-right: 8px; }

        .nav-item {
            padding: 8px 20px 8px 35px;
            cursor: pointer;
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--text-sub);
            font-size: 14px;
            transition: all 0.2s;
            position: relative;
        }

        .nav-item:hover {
            background-color: var(--hover-bg);
            color: var(--text-main);
        }

        .nav-item.active {
            color: var(--accent-color);
            background-color: #262f3e; /* æ·¡è“èƒŒæ™¯ */
            border-right: 3px solid var(--accent-color);
        }

        .nav-item i { margin-right: 8px; font-size: 14px; }
        
        /* ä¾§è¾¹æ åº•éƒ¨å·¥å…·æ  */
        .sidebar-footer {
            padding: 15px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
        }

        /* --- å³ä¾§ä¸»å†…å®¹åŒº (æ¨¡ä»¿å›¾ç‰‡ä¸­çš„å¤´éƒ¨å’Œè¯¦æƒ…) --- */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 40px 60px;
            background-image: linear-gradient(to bottom, #1e1e1e 0%, var(--bg-main) 300px);
        }

        /* é¡¶éƒ¨å¤§æ ‡é¢˜åŒºåŸŸ */
        .doc-header { margin-bottom: 40px; border-bottom: 1px solid var(--border-color); padding-bottom: 30px; }

        .doc-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #fff;
        }

        .doc-meta {
            display: flex;
            gap: 20px;
            color: var(--text-sub);
            font-size: 14px;
            align-items: center;
        }
        
        .doc-meta span { display: flex; align-items: center; gap: 6px; }

        .doc-tags { margin-top: 15px; display: flex; gap: 10px; }
        .tag {
            background: var(--tag-bg);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            color: var(--text-main);
            border: 1px solid #3e3e3e;
        }

        /* åˆ›å»ºæŒ‰é’®æ ·å¼ */
        .btn-create {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .btn-create:hover { background-color: #2a75d1; }

        /* å†…å®¹å ä½ç¬¦ */
        .content-placeholder {
            line-height: 1.8;
            color: #ccc;
        }
        
        .content-placeholder h2 { margin: 30px 0 15px; color: #fff; font-size: 24px;}
        .content-placeholder p { margin-bottom: 15px; }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-sidebar); }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .sidebar { display: none; } /* ç§»åŠ¨ç«¯æš‚æ—¶éšè—ä¾§è¾¹æ  */
            .main-content { padding: 20px; }
        }
    </style>
</head>
<body>

    <!-- ä¾§è¾¹æ  -->
    <aside class="sidebar">
        <div class="search-container">
            <div class="search-box">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="text" placeholder="æœç´¢...">
            </div>
        </div>

        <ul class="nav-list" id="sidebar-list">
            <li style="text-align:center; color:#666; padding:20px;">
                <i class="fa-solid fa-spinner fa-spin"></i> åŠ è½½ä¸­...
            </li>
        </ul>

        <div class="sidebar-footer">
            <a href="#" style="color:var(--text-sub); text-decoration:none;">
                <i class="fa-regular fa-moon"></i>
            </a>
            <span style="font-size:12px; color:#555">v1.0.0</span>
        </div>
    </aside>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-content">
        <!-- è¿™é‡Œæ¨¡ä»¿å›¾ç‰‡ä¸­çš„ Header åŒºåŸŸ -->
        <div class="doc-header">
            <div style="display:flex; justify-content:space-between; align-items:start;">
                <h1 class="doc-title" id="preview-title">ğŸ‘‹ æ¬¢è¿å›æ¥</h1>
                <a href="editor.html" class="btn-create">
                    <i class="fa-solid fa-plus"></i> æ–°å»ºè´´æ–‡
                </a>
            </div>
            
            <div class="doc-meta">
                <span id="preview-date"><i class="fa-regular fa-calendar"></i> ä»Šå¤©</span>
                <span><i class="fa-regular fa-user"></i> Admin</span>
                <span><i class="fa-regular fa-clock"></i> <span id="file-count">0</span> ç¯‡æ–‡ç« </span>
            </div>

            <div class="doc-tags">
                <span class="tag">ä»ªè¡¨ç›˜</span>
                <span class="tag">ç®¡ç†</span>
            </div>
        </div>

        <div class="content-placeholder">
            <h2 id="section-title">ç®€ä»‹</h2>
            <p>ç‚¹å‡»å·¦ä¾§ä¾§è¾¹æ çš„æ–‡ç« ä»¥è¿›è¡Œç¼–è¾‘æˆ–æŸ¥çœ‹ã€‚æ­¤ç•Œé¢æ¨¡ä»¿äº† FA2SP HDM Edition çš„æ–‡æ¡£é£æ ¼ã€‚</p>
            <p style="color:var(--text-sub); font-size: 14px;">
                * å½“å‰åˆ—è¡¨å±•ç¤ºæ‰€æœ‰ .md æ–‡ä»¶ã€‚<br>
                * æ‚¬åœåœ¨æ–‡ä»¶ä¸Šå¯å¿«é€Ÿç¼–è¾‘ã€‚<br>
                * æ­¤é¡µé¢æ˜¯é™æ€ HTMLï¼Œé€šè¿‡ JS è¯»å– API æ•°æ®ã€‚
            </p>
        </div>
    </main>

    <script type="module">
        import { listPosts } from "./js/api.js";
        
        const sidebarList = document.getElementById("sidebar-list");
        const fileCountSpan = document.getElementById("file-count");

        async function init() {
            try {
                const posts = await listPosts();
                // è¿‡æ»¤ md æ–‡ä»¶
                const mdFiles = posts.filter(p => p.name.endsWith(".md"));
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                fileCountSpan.innerText = mdFiles.length;

                if (mdFiles.length === 0) {
                    sidebarList.innerHTML = "<li class='nav-item'>æš‚æ— æ–‡ç« </li>";
                    return;
                }

                // æ’åºï¼šæœ€æ–°çš„åœ¨å‰
                mdFiles.sort((a, b) => b.name.localeCompare(a.name));
                
                sidebarList.innerHTML = "";
                
                // æ¨¡æ‹Ÿåˆ†ç»„ï¼šè¿™é‡Œæˆ‘åŠ äº†ä¸€ä¸ªå‡çš„â€œæ–‡ç« åˆ—è¡¨â€æ–‡ä»¶å¤¹æ ‡é¢˜
                // å¦‚æœä½ æƒ³æ ¹æ®æ–‡ä»¶ååˆ†ç»„ï¼ˆä¾‹å¦‚ "Dev-Log-1.md"ï¼‰ï¼Œå¯ä»¥åœ¨è¿™é‡Œå†™é€»è¾‘
                const groupTitle = document.createElement("li");
                groupTitle.className = "nav-group-title";
                groupTitle.innerHTML = '<i class="fa-regular fa-folder-open"></i> å…¨éƒ¨æ–‡ç« ';
                sidebarList.appendChild(groupTitle);

                for (const file of mdFiles) {
                    const li = document.createElement("li");
                    
                    // ç®€å•çš„æ–‡ä»¶åå¤„ç†
                    let displayName = decodeURIComponent(file.name).replace(".md", "");
                    // å»æ‰å¼€å¤´çš„æ—¥æœŸï¼ˆå¦‚æœå­˜åœ¨ YYYY-MM-DD-ï¼‰
                    displayName = displayName.replace(/^\d{4}-\d{1,2}-\d{1,2}-/, "");

                    // æ„å»ºå·¦ä¾§é“¾æ¥
                    // ç‚¹å‡»æ ‡é¢˜è¿›å…¥é˜…è¯»é¡µï¼Œå³ä¾§å¢åŠ ä¸€ä¸ªå°çš„ç¼–è¾‘å›¾æ ‡
                    li.innerHTML = `
                        <a href="post.html?f=${file.name}" class="nav-item">
                            <i class="fa-regular fa-file-lines"></i>
                            <span style="flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${displayName}</span>
                            <!-- ç¼–è¾‘æŒ‰é’® -->
                            <span onclick="event.preventDefault(); window.location.href='editor.html?edit=${file.name}'" 
                                  style="padding:2px 6px; border-radius:4px; font-size:10px; background:#333; color:#aaa;" 
                                  title="ç¼–è¾‘">
                                <i class="fa-solid fa-pen"></i>
                            </span>
                        </a>
                    `;
                    sidebarList.appendChild(li);
                }
            } catch (e) {
                console.error(e);
                sidebarList.innerHTML = `<li style="color:#ff6b6b; padding:15px">âš ï¸ åŠ è½½å¤±è´¥</li>`;
            }
        }
        init();
    </script>
</body>
</html>
